import requests
import pandas as pd
import time
import re
import nltk

nltk.download('stopwords')
from nltk.corpus import stopwords

# Очистка текста
russian_stopwords = set(stopwords.words("russian"))

def clean_text(text):
    text = str(text).lower()
    text = re.sub(r'[^а-яё\s]', '', text)
    words = text.split()
    words = [word for word in words if word not in russian_stopwords]
    return " ".join(words)

# Функция для парсинга отзывов по одному товару
def get_reviews(product_id, max_pages=3):
    reviews = []
    headers = {'User-Agent': 'Mozilla/5.0'}

    for page in range(1, max_pages + 1):
        url = f"https://www.ozon.ru/api/composer-api.bx/page/json/v2?url=/product/{product_id}/reviews?page={page}"
        response = requests.get(url, headers=headers)

        if response.status_code != 200:
            break

        data = response.json()
        try:
            items = data['widgetStates']['webReviewList']['reviews']
            for item in items:
                reviews.append({
                    'text': item['text'],
                    'rating': item['rating'],
                    'authorName': item['authorName'],
                    'createdAt': item['createdAt']
                })
        except KeyError:
            break

        time.sleep(1)
    return reviews

# Функция для сбора отзывов по категориям
def get_reviews_for_products(product_ids, label, max_pages=3):
    all_reviews = []
    for pid in product_ids:
        reviews = get_reviews(pid, max_pages)
        for review in reviews:
            review['product_id'] = pid
            review['category'] = label
        all_reviews.extend(reviews)
    return all_reviews

# ID товаров
women_ids = [1131621478, 2030177793, 277013878, 287889610]
men_ids = [218820548, 186894245, 2033971623, 2038415935]

# Сбор данных
women_reviews = get_reviews_for_products(women_ids, "Women")
men_reviews = get_reviews_for_products(men_ids, "Men")

# Объединение и очистка
df_reviews = pd.DataFrame(women_reviews + men_reviews)
df_reviews['clean_text'] = df_reviews['text'].apply(clean_text)
df_reviews['text_len'] = df_reviews['clean_text'].apply(lambda x: len(x.split()))

# Сохранение
csv_path = "/mnt/data/ozon_reviews.csv"
df_reviews.to_csv(csv_path, index=False)
csv_path что это за код
